<!-- ASIGNAR TAREAS -->
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Asignar Tareas - CTX</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="css/lista_categorias.css">
  <link rel="stylesheet" href="css/Principal.css">
  <link rel="stylesheet" href="css/desp.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    @font-face {
  font-family: 'MiFuente';
  src: url('tipografias/berbel-serif.ttf') format('truetype');
}
        @font-face {
  font-family: 'si';
  src: url('tipografias/Kiona-Regular.ttf') format('truetype');
}

    a, h1 { font-family: si; }
  </style>
</head>
<body>
  <!-- encabezado-->
<div class="container-fluid">
  <div class="contenedor_encabezado"> 
  
 <div class="logo"><a href="index.html"><img src="img/siu.png" alt=""></a></div>
  
  
    <div class="titulo">
      <h1>CTX</h1>
    </div>

 <div class="sesion" id="estado-sesion">
  <!-- El contenido se llenará con JS -->
</div>
    <div class="carro">
  
    
    </div>



  </div>

<div class="desplazar">
  <a class="nav-link active menu-icon" onclick="abrirSidebarJefe()" style="color: white;">
    <i class="fa-solid fa-bars fa-2x"></i>
  </a>
</div>

</div>

<div class="linea"></div>






<!-- SIDEBAR PARA JEFE -->
<div id="sidebar-jefe" class="sidebar" >
  <span class="closebtn" onclick="closeNav()">&times;</span>
  <a href="index.html">Inicio</a>
  <a href="#" onclick="toggleSubmenu('submenu-Tipos')">Usuarios <i class="fa-solid fa-caret-down"></i></a>
  <ul id="submenu-Tipos" style="display: none; padding-left: 20px;">
    <li><a class="dropdown-item" href="Listado_de_empleados.html">Empleados</a></li>
    <li><a class="dropdown-item" href="Listado_de_compradores.html">Compradores</a></li>
  </ul>
  <a href="tareas.html">Asignaciones</a>
  <a href="agregar_productos.html">Agregar Producto</a>
     <a href="Opiniones.html">Opiniones</a>
</div>

<div class="lista">
<h1>Asignar Tarea</h1>
</div>







<div class="container mt-5">

  <form id="form-tarea" class="border p-4 rounded bg-light">
    <div class="mb-3">
      <label for="empleado" class="form-label">Empleado</label>
      <select class="form-control" id="empleado">
        <option value="">Selecciona un empleado</option>
      </select>
    </div>
    <div class="mb-3">
      <label for="titulo" class="form-label">Título de la Tarea</label>
      <input type="text" class="form-control" id="titulo" required>
    </div>
    <div class="mb-3">
      <label for="descripcion" class="form-label">Descripción</label>
      <textarea class="form-control" id="descripcion" rows="3" required></textarea>
    </div>
    <div class="mb-3">
      <label for="fechaLimite" class="form-label">Fecha Límite</label>
      <input type="date" class="form-control" id="fechaLimite" required>
    </div>
    <div class="mb-3">
      <label for="prioridad" class="form-label">Prioridad</label>
      <select class="form-control" id="prioridad">
        <option value="alta">Alta</option>
        <option value="media">Media</option>
        <option value="baja">Baja</option>
      </select>
    </div>
    <button type="submit" class="btn btn-primary">Asignar Tarea</button>
  </form>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.2/firebase-app.js";
  import { getFirestore, collection, query, where, getDocs, addDoc } from "https://www.gstatic.com/firebasejs/10.5.2/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyANzU0sPRyGdnHPeZ2Lqr2pio5eSvvDKaw",
    authDomain: "agencia-ctx.firebaseapp.com",
    projectId: "agencia-ctx",
    storageBucket: "agencia-ctx.appspot.com",
    messagingSenderId: "981141252542",
    appId: "1:981141252542:web:88330078160793d9f271ef",
    measurementId: "G-SZQLZXMWP4"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const selectEmpleado = document.getElementById("empleado");

  async function cargarEmpleados() {
    const snapshot = await getDocs(query(collection(db, "usuarios"), where("tipo", "==", "Empleado")));
    snapshot.forEach(doc => {
      const u = doc.data();
      const nombreCompleto = `${u.nombre} ${u.apellido || ""}`.trim();
      const option = document.createElement("option");
      option.value = doc.id; // UID del usuario
      option.textContent = nombreCompleto;
      selectEmpleado.appendChild(option);
    });
  }

  cargarEmpleados();

  document.getElementById("form-tarea").addEventListener("submit", async (e) => {
    e.preventDefault();

    const empleadoId = selectEmpleado.value;
    const titulo = document.getElementById("titulo").value.trim();
    const descripcion = document.getElementById("descripcion").value.trim();
    const fechaLimite = new Date(document.getElementById("fechaLimite").value);
    const prioridad = document.getElementById("prioridad").value;

    if (!empleadoId || !titulo || !descripcion || isNaN(fechaLimite)) {
      alert("Completa todos los campos correctamente.");
      return;
    }

    try {
      await addDoc(collection(db, "tareas"), {
        empleadoId,
        titulo,
        descripcion,
        fechaLimite,
        prioridad,
        estado: "pendiente",
        fechaAsignacion: new Date()
      });

      alert("✅ Tarea asignada correctamente.");
      e.target.reset();
    } catch (err) {
      console.error("Error al guardar:", err);
      alert("❌ Error al asignar la tarea.");
    }
  });
</script>
<script src="javas/jefe.js"></script>

</body>
</html>
